<div class="container-fluid" ng-init="init()">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2 class="text-center mb-4" >My Biddings</h2>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Filter and Search</h3>
                </div>
                <div class="panel-body">
                    <div class="row">

                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="input-group" style="width: 100%;">
                                    <div class="dropdown" uib-dropdown dropdown-append-to-body style="width: 100%;">
                                        <button type="button" class="btn btn-primary btn-block text-left" uib-dropdown-toggle>
                                            <span class="glyphicon glyphicon-filter"></span>
                                            Status: {{biddingStatus ? (biddingStatus | uppercase) : 'Select Status'}} 
                                            <span class="caret pull-right" style="position: absolute; right: 8px; top: 50%; margin-top: -2px;"></span>
                                        </button>
                                        <ul class="dropdown-menu" uib-dropdown-menu>
                                            <li><a href class="dropdown-item" ng-click="biddingStatus = 'pending'; applyFilter()">Pending</a></li>
                                            <li><a href class="dropdown-item" ng-click="biddingStatus = 'rejected'; applyFilter()">Rejected</a></li>
                                            <li><a href class="dropdown-item" ng-click="biddingStatus = 'approved'; applyFilter()">Approved</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
            

                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <i class="glyphicon glyphicon-search"></i>
                                    </span>
                                    <input type="text"
                                           class="form-control"
                                           ng-model="search.carQuery"
                                           ng-change="applyFilter()"
                                           ng-model-options="{ debounce: 500 }"
                                           placeholder="Search by Car Name or Company">
                                </div>
                            </div>
                        </div>
            
                        <div class="col-sm-3">
                            <div class="form-group">
                                <div class="input-group" style="width:100%;">
                                    <div class="dropdown input-group-btn" uib-dropdown dropdown-append-to-body style="width: 100%">
                                        <button type="button" class="btn btn-primary btn-block text-left py-2 px-3 small" style="border-radius: 4px;" uib-dropdown-toggle>
                                            <span class="glyphicon glyphicon-sort"></span>
                                            <span class="sort-label">Sort By: </span>
                                            <span class="sort-value text-truncate d-inline-block" style="max-width: 120px;" title="{{getSortLabel()}}">
                                              {{getSortLabel()}}
                                            </span>
                                            <span class="caret pull-right" style="position: absolute; right: 8px; top: 50%; margin-top: -2px;"></span>
                                          </button>
                                          
                                          
                                          
                                        <ul class="dropdown-menu" uib-dropdown-menu>
                                            <li><a href class="dropdown-item" ng-click="setSort('amount', 'asc')">
                                                <i ng-class="{'fa fa-check': sortField === 'amount' && sortOrder === 'asc'}"></i> Price: Low-High
                                            </a></li>
                                            <li><a href class="dropdown-item" ng-click="setSort('amount', 'desc')">
                                                <i ng-class="{'fa fa-check': sortField === 'amount' && sortOrder === 'desc'}"></i> Price: High-Low
                                            </a></li>
                                            <li class="divider"></li>
                                            <li><a href class="dropdown-item" ng-click="setSort('startDate', 'asc')">
                                                <i ng-class="{'fa fa-check': sortField === 'startDate' && sortOrder === 'asc'}"></i> Earliest Starting
                                            </a></li>
                                            <li><a href class="dropdown-item" ng-click="setSort('startDate', 'desc')">
                                                <i ng-class="{'fa fa-check': sortField === 'startDate' && sortOrder === 'desc'}"></i> Latest Starting
                                            </a></li>
                                            <li class="divider"></li>
                                            <li><a href class="dropdown-item" ng-click="setSort('createdAt', 'desc')">
                                                <i ng-class="{'fa fa-check': sortField === 'createdAt' && sortOrder === 'desc'}"></i> Newest First
                                            </a></li>
                                            <li><a href class="dropdown-item" ng-click="setSort('createdAt', 'asc')">
                                                <i ng-class="{'fa fa-check': sortField === 'createdAt' && sortOrder === 'asc'}"></i> Oldest First
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-3">
                            <button type="button" class="btn btn-default btn-block" ng-click="resetFilter()">
                                <span class="glyphicon glyphicon-refresh"></span> Reset Filters
                            </button>
                        </div>
            
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <div class="text-center" ng-show="isLoading">
        <i class="fa fa-spinner fa-spin fa-3x fa-fw text-primary"></i>
        <span class="text-primary">Loading...</span>
    </div>

    <div class="row" ng-show="bookings.length > 0">
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Bidding Details</h3>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-hover table-bordered table-striped table-condensed">
                            <thead>
                                <tr>

                                    <th>Car Details</th>
                                    <th>Dates</th>
                                    <th>Price Details</th>
                                    <th>Owner Info</th>
                                    <th>Status</th>
                                    <th>Add-ons</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="booking in bookings">

                                    <td>
                                        <strong>{{booking.vehicle.company}} {{booking.vehicle.name}}</strong>
                                        <div class="text-muted">
                                            <small>{{booking.vehicle.modelYear}} • {{booking.vehicle.fuelType}}</small>
                                        </div>
                                    </td>
                                    <td>
                                        <div><small>Start:</small> {{booking.startDate | date: 'MMM dd, yyyy'}}</div>
                                        <div><small>End:</small> {{booking.endDate | date: 'MMM dd, yyyy'}}</div>
                                    </td>
                                    <td>
                                        <div><strong>{{ booking.amount | currency:"₹" }}</strong>/day</div>
                                        <div class="text-muted"><small>Total:</small> {{ booking.calculate() | currency:"₹" }}</div>
                                    </td>
                                    <td>
                                        <div>{{booking.owner.firstName}} {{booking.owner.lastName}}</div>
                                        <div class="text-muted"><small>@{{booking.owner.username}}</small></div>
                                    </td>
                                    <td>
                                        <span class="label" ng-class="{
                                            'label-warning': booking.status === 'pending',
                                            'label-danger': booking.status === 'rejected',
                                            'label-success': booking.status === 'approved'
                                        }">{{ booking.status | uppercase }}</span>
                                    </td>
                                    <td>
                                        <div ng-if="booking.selectedAddons && booking.selectedAddons.length > 0">
                                            <ul class="list-unstyled small">
                                                <li ng-repeat="addon in booking.selectedAddons">
                                                    <i class="fa fa-check-circle text-success"></i> {{addon.name}}
                                                    <span class="text-muted">{{addon.price | currency:"₹"}}</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="text-muted small" ng-if="!booking.selectedAddons || booking.selectedAddons.length === 0">
                                            <i class="fa fa-info-circle"></i> No add-ons
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" ng-show="!bookings.length && !isLoading">
        <div class="col-md-6 col-md-offset-3">
            <div class="well text-center">
                <h1>🚗</h1>
                <h2 class="text-muted">No Biddings Found</h2>
                <p class="text-muted lead" ng-if="biddingStatus">
                    No {{biddingStatus}} biddings available.
                </p>
                <button class="btn btn-primary" ng-click="resetFilter()">
                    <i class="fa fa-refresh"></i> Reset Filters
                </button>
            </div>
        </div>
    </div>

    <div class="text-center" ng-if="pagination.totalItems > 0">
        <ul uib-pagination
            total-items="pagination.totalItems"
            ng-model="pagination.currentPage"
            max-size="pagination.maxSize"
            class="pagination-sm"
            boundary-links="true"
            force-ellipses="true"
            items-per-page="pagination.itemsPerPage"
            ng-change="pageChanged()"
            first-text="&laquo;"
            last-text="&raquo;"
            previous-text="&lsaquo;"
            next-text="&rsaquo;"
            direction-links="true"
            rotate="true">
        </ul>
    </div>
</div>

<style>
.pagination > li > a {
    cursor: pointer;
}
.well {
    margin-top: 20px;
}

/* Style for the sort button */
.dropdown button.btn-block {
    position: relative;
    padding-right: 25px; /* Space for the caret */
    overflow: hidden;
}

/* Container for the sort text */
.sort-value {
    display: inline-block;
    max-width: 120px; /* Adjust based on your needs */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: bottom;
}

/* Style for the caret */
.dropdown button.btn-block .caret {
    position: absolute;
    right: 10px;
    top: 50%;
    margin-top: -2px;
}
</style>